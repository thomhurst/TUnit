[  
#nullable enable

using System;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;
using TUnit.Assertions.Core;
using TUnit.Assertions.Tests.TestData;

namespace TUnit.Assertions.Extensions;

/// <summary>
/// Generated assertion for ContainsMatch
/// </summary>
public sealed class IEnumerableString_ContainsMatch_String_Assertion : Assertion<System.Collections.Generic.IEnumerable<string>>
{
    private readonly string _needle;
    private string? _result;

    public IEnumerableString_ContainsMatch_String_Assertion(AssertionContext<System.Collections.Generic.IEnumerable<string>> context, string needle)
        : base(context)
    {
        _needle = needle;
    }

    protected override Task<AssertionResult> CheckAsync(EvaluationMetadata<System.Collections.Generic.IEnumerable<string>> metadata)
    {
        var value = metadata.Value;
        var exception = metadata.Exception;

        if (exception != null)
        {
            return Task.FromResult(AssertionResult.Failed($"threw {exception.GetType().FullName}"));
        }

        if (value is null)
        {
            return Task.FromResult(AssertionResult.Failed("Actual value is null"));
        }

        var typedResult = value!.ContainsMatch(_needle);
        if (typedResult.IsPassed)
        {
            _result = typedResult.Value;
        }
        return Task.FromResult(typedResult.IsPassed
            ? AssertionResult.Passed
            : AssertionResult.Failed(typedResult.Message));
    }

    protected override string GetExpectation()
    {
        return $"to contain '{_needle}'";
    }

    public new System.Runtime.CompilerServices.TaskAwaiter<string> GetAwaiter()
    {
        return ExecuteAndReturnResultAsync().GetAwaiter();
    }

    private async Task<string> ExecuteAndReturnResultAsync()
    {
        await AssertAsync();
        return _result!;
    }
}

public static partial class AssertionResultOfTMethodExtensions
{
    /// <summary>
    /// Generated extension method for ContainsMatch
    /// </summary>
    public static IEnumerableString_ContainsMatch_String_Assertion ContainsMatch(this IAssertionSource<System.Collections.Generic.IEnumerable<string>> source, string needle, [CallerArgumentExpression(nameof(needle))] string? needleExpression = null)
    {
        source.Context.ExpressionBuilder.Append($".ContainsMatch({needleExpression})");
        return new IEnumerableString_ContainsMatch_String_Assertion(source.Context, needle);
    }

}

]