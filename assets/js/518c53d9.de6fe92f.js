"use strict";(self.webpackChunktunit_docs_site=self.webpackChunktunit_docs_site||[]).push([[5967],{1603:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"guides/cookbook","title":"Testing Cookbook","description":"This cookbook provides practical, copy-paste examples for common testing scenarios with TUnit. Each recipe is a complete, working example you can adapt for your own tests.","source":"@site/docs/guides/cookbook.md","sourceDirName":"guides","slug":"/guides/cookbook","permalink":"/docs/guides/cookbook","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Performance Best Practices","permalink":"/docs/advanced/performance-best-practices"},"next":{"title":"Examples","permalink":"/docs/examples/intro"}}');var r=t(4848),i=t(8453);const a={},c="Testing Cookbook",o={},l=[{value:"Dependency Injection Testing",id:"dependency-injection-testing",level:2},{value:"Testing with Microsoft.Extensions.DependencyInjection",id:"testing-with-microsoftextensionsdependencyinjection",level:3},{value:"Testing with Scoped Services",id:"testing-with-scoped-services",level:3},{value:"API Testing with WebApplicationFactory",id:"api-testing-with-webapplicationfactory",level:2},{value:"Testing a Minimal API Endpoint (Shared Server)",id:"testing-a-minimal-api-endpoint-shared-server",level:3},{value:"Testing with Authentication (Per-Test Setup)",id:"testing-with-authentication-per-test-setup",level:3},{value:"Mocking Patterns",id:"mocking-patterns",level:2},{value:"Using Moq",id:"using-moq",level:3},{value:"Using NSubstitute",id:"using-nsubstitute",level:3},{value:"Partial Mocks and Spy Pattern",id:"partial-mocks-and-spy-pattern",level:3},{value:"Data-Driven Test Patterns",id:"data-driven-test-patterns",level:2},{value:"Using MethodDataSource",id:"using-methoddatasource",level:3},{value:"Using MethodDataSource with Complex Objects",id:"using-methoddatasource-with-complex-objects",level:3},{value:"Using DataSourceGenerator",id:"using-datasourcegenerator",level:3},{value:"Exception Testing",id:"exception-testing",level:2},{value:"Testing for Specific Exceptions",id:"testing-for-specific-exceptions",level:3},{value:"Testing Exception Messages and Properties",id:"testing-exception-messages-and-properties",level:3},{value:"Testing Async Exceptions",id:"testing-async-exceptions",level:3},{value:"Integration Test Patterns",id:"integration-test-patterns",level:2},{value:"Testing with In-Memory Database",id:"testing-with-in-memory-database",level:3},{value:"Testing with Test Containers (Docker)",id:"testing-with-test-containers-docker",level:3},{value:"Testing HTTP Client Integration",id:"testing-http-client-integration",level:3},{value:"Testing File System Operations",id:"testing-file-system-operations",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"testing-cookbook",children:"Testing Cookbook"})}),"\n",(0,r.jsx)(n.p,{children:"This cookbook provides practical, copy-paste examples for common testing scenarios with TUnit. Each recipe is a complete, working example you can adapt for your own tests."}),"\n",(0,r.jsx)(n.h2,{id:"dependency-injection-testing",children:"Dependency Injection Testing"}),"\n",(0,r.jsx)(n.h3,{id:"testing-with-microsoftextensionsdependencyinjection",children:"Testing with Microsoft.Extensions.DependencyInjection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Extensions.DependencyInjection;\nusing TUnit.Core;\n\npublic class UserServiceTests\n{\n    private ServiceProvider? _serviceProvider;\n    private IUserService? _userService;\n\n    [Before(Test)]\n    public async Task Setup()\n    {\n        // Create a service collection and register dependencies\n        var services = new ServiceCollection();\n\n        // Register services\n        services.AddSingleton<IUserRepository, InMemoryUserRepository>();\n        services.AddScoped<IUserService, UserService>();\n        services.AddLogging();\n\n        _serviceProvider = services.BuildServiceProvider();\n        _userService = _serviceProvider.GetRequiredService<IUserService>();\n    }\n\n    [After(Test)]\n    public async Task Cleanup()\n    {\n        _serviceProvider?.Dispose();\n    }\n\n    [Test]\n    public async Task CreateUser_RegistersNewUser()\n    {\n        var email = "test@example.com";\n        var name = "Test User";\n\n        var user = await _userService!.CreateAsync(email, name);\n\n        await Assert.That(user.Email).IsEqualTo(email);\n        await Assert.That(user.Name).IsEqualTo(name);\n        await Assert.That(user.Id).IsNotEqualTo(Guid.Empty);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"testing-with-scoped-services",children:"Testing with Scoped Services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class OrderServiceTests\n{\n    private ServiceProvider? _serviceProvider;\n\n    [Before(Test)]\n    public async Task Setup()\n    {\n        var services = new ServiceCollection();\n        services.AddDbContext<OrderDbContext>(options =>\n            options.UseInMemoryDatabase("TestDb"));\n        services.AddScoped<IOrderService, OrderService>();\n\n        _serviceProvider = services.BuildServiceProvider();\n    }\n\n    [After(Test)]\n    public async Task Cleanup()\n    {\n        _serviceProvider?.Dispose();\n    }\n\n    [Test]\n    public async Task CreateOrder_UsesScop\u200bedDbContext()\n    {\n        // Create a scope for this test\n        using var scope = _serviceProvider!.CreateScope();\n        var orderService = scope.ServiceProvider.GetRequiredService<IOrderService>();\n\n        var order = await orderService.CreateAsync(new CreateOrderRequest\n        {\n            CustomerId = 1,\n            Items = new[] { new OrderItem { ProductId = 1, Quantity = 2 } }\n        });\n\n        await Assert.That(order.Id).IsGreaterThan(0);\n        await Assert.That(order.Items).HasCount().EqualTo(1);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"api-testing-with-webapplicationfactory",children:"API Testing with WebApplicationFactory"}),"\n",(0,r.jsx)(n.h3,{id:"testing-a-minimal-api-endpoint-shared-server",children:"Testing a Minimal API Endpoint (Shared Server)"}),"\n",(0,r.jsx)(n.p,{children:"For API tests, it's more efficient to share a single WebApplicationFactory across all tests:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.AspNetCore.Mvc.Testing;\nusing System.Net;\nusing System.Net.Http.Json;\nusing TUnit.Core;\n\n// Shared web server for all API tests\npublic class TestWebServer : IAsyncInitializer, IAsyncDisposable\n{\n    public WebApplicationFactory<Program>? Factory { get; private set; }\n\n    public async Task InitializeAsync()\n    {\n        Factory = new WebApplicationFactory<Program>();\n        await Task.CompletedTask;\n    }\n\n    public async ValueTask DisposeAsync()\n    {\n        if (Factory != null)\n            await Factory.DisposeAsync();\n    }\n}\n\n[ClassDataSource<TestWebServer>(Shared = SharedType.PerTestSession)]\npublic class UserApiTests(TestWebServer server)\n{\n    [Test]\n    public async Task GetUsers_ReturnsSuccessStatus()\n    {\n        var client = server.Factory!.CreateClient();\n        var response = await client.GetAsync("/api/users");\n\n        await Assert.That(response.StatusCode).IsEqualTo(HttpStatusCode.OK);\n    }\n\n    [Test]\n    public async Task CreateUser_ReturnsCreatedUser()\n    {\n        var client = server.Factory!.CreateClient();\n        var newUser = new CreateUserRequest\n        {\n            Email = "test@example.com",\n            Name = "Test User"\n        };\n\n        var response = await client.PostAsJsonAsync("/api/users", newUser);\n\n        await Assert.That(response.StatusCode).IsEqualTo(HttpStatusCode.Created);\n\n        var user = await response.Content.ReadFromJsonAsync<UserResponse>();\n        await Assert.That(user).IsNotNull();\n        await Assert.That(user!.Email).IsEqualTo(newUser.Email);\n    }\n\n    [Test]\n    public async Task GetUser_WithInvalidId_ReturnsNotFound()\n    {\n        var client = server.Factory!.CreateClient();\n        var response = await client.GetAsync("/api/users/99999");\n\n        await Assert.That(response.StatusCode).IsEqualTo(HttpStatusCode.NotFound);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"testing-with-authentication-per-test-setup",children:"Testing with Authentication (Per-Test Setup)"}),"\n",(0,r.jsx)(n.p,{children:"When each test needs different configuration (like different auth setups), use per-test hooks:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class AuthenticatedApiTests\n{\n    private WebApplicationFactory<Program>? _factory;\n    private HttpClient? _client;\n\n    [Before(Test)]\n    public async Task Setup()\n    {\n        _factory = new WebApplicationFactory<Program>()\n            .WithWebHostBuilder(builder =>\n            {\n                builder.ConfigureServices(services =>\n                {\n                    // Configure test authentication\n                    services.AddAuthentication("Test")\n                        .AddScheme<TestAuthenticationOptions, TestAuthenticationHandler>(\n                            "Test", options => { });\n                });\n            });\n\n        _client = _factory.CreateClient();\n\n        // Add auth header\n        _client.DefaultRequestHeaders.Authorization =\n            new System.Net.Http.Headers.AuthenticationHeaderValue("Test");\n    }\n\n    [After(Test)]\n    public async Task Cleanup()\n    {\n        _client?.Dispose();\n        if (_factory != null)\n            await _factory.DisposeAsync();\n    }\n\n    [Test]\n    public async Task GetProfile_WithAuth_ReturnsUserProfile()\n    {\n        var response = await _client!.GetAsync("/api/profile");\n\n        await Assert.That(response.StatusCode).IsEqualTo(HttpStatusCode.OK);\n        var profile = await response.Content.ReadFromJsonAsync<UserProfile>();\n        await Assert.That(profile).IsNotNull();\n    }\n\n    [Test]\n    public async Task GetProfile_WithoutAuth_ReturnsUnauthorized()\n    {\n        _client!.DefaultRequestHeaders.Authorization = null;\n\n        var response = await _client.GetAsync("/api/profile");\n\n        await Assert.That(response.StatusCode).IsEqualTo(HttpStatusCode.Unauthorized);\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tip"}),": Use per-test setup (hooks) when tests need different configurations. Use shared setup (",(0,r.jsx)(n.code,{children:"ClassDataSource"})," with ",(0,r.jsx)(n.code,{children:"SharedType.PerTestSession"}),") when all tests can use the same configuration."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"mocking-patterns",children:"Mocking Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"using-moq",children:"Using Moq"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using Moq;\nusing TUnit.Core;\n\npublic class OrderServiceMoqTests\n{\n    [Test]\n    public async Task ProcessOrder_CallsPaymentService()\n    {\n        // Arrange\n        var mockPaymentService = new Mock<IPaymentService>();\n        mockPaymentService\n            .Setup(p => p.ProcessPaymentAsync(It.IsAny<decimal>(), It.IsAny<string>()))\n            .ReturnsAsync(new PaymentResult { Success = true, TransactionId = "TX123" });\n\n        var orderService = new OrderService(mockPaymentService.Object);\n        var order = new Order { Total = 100.00m, PaymentMethod = "Credit Card" };\n\n        // Act\n        var result = await orderService.ProcessAsync(order);\n\n        // Assert\n        await Assert.That(result.IsSuccess).IsTrue();\n        mockPaymentService.Verify(\n            p => p.ProcessPaymentAsync(100.00m, "Credit Card"),\n            Times.Once);\n    }\n\n    [Test]\n    public async Task ProcessOrder_HandlesPaymentFailure()\n    {\n        // Arrange\n        var mockPaymentService = new Mock<IPaymentService>();\n        mockPaymentService\n            .Setup(p => p.ProcessPaymentAsync(It.IsAny<decimal>(), It.IsAny<string>()))\n            .ThrowsAsync(new PaymentException("Insufficient funds"));\n\n        var orderService = new OrderService(mockPaymentService.Object);\n        var order = new Order { Total = 1000.00m, PaymentMethod = "Credit Card" };\n\n        // Act & Assert\n        await Assert.That(async () => await orderService.ProcessAsync(order))\n            .ThrowsExactly<PaymentException>()\n            .WithMessage("Insufficient funds");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"using-nsubstitute",children:"Using NSubstitute"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using NSubstitute;\nusing NSubstitute.ExceptionExtensions;\nusing TUnit.Core;\n\npublic class OrderServiceNSubstituteTests\n{\n    [Test]\n    public async Task ProcessOrder_CallsPaymentService()\n    {\n        // Arrange\n        var paymentService = Substitute.For<IPaymentService>();\n        paymentService\n            .ProcessPaymentAsync(Arg.Any<decimal>(), Arg.Any<string>())\n            .Returns(new PaymentResult { Success = true, TransactionId = "TX123" });\n\n        var orderService = new OrderService(paymentService);\n        var order = new Order { Total = 100.00m, PaymentMethod = "Credit Card" };\n\n        // Act\n        var result = await orderService.ProcessAsync(order);\n\n        // Assert\n        await Assert.That(result.IsSuccess).IsTrue();\n        await paymentService.Received(1).ProcessPaymentAsync(100.00m, "Credit Card");\n    }\n\n    [Test]\n    public async Task ProcessOrder_HandlesPaymentFailure()\n    {\n        // Arrange\n        var paymentService = Substitute.For<IPaymentService>();\n        paymentService\n            .ProcessPaymentAsync(Arg.Any<decimal>(), Arg.Any<string>())\n            .Throws(new PaymentException("Insufficient funds"));\n\n        var orderService = new OrderService(paymentService);\n        var order = new Order { Total = 1000.00m, PaymentMethod = "Credit Card" };\n\n        // Act & Assert\n        await Assert.That(async () => await orderService.ProcessAsync(order))\n            .ThrowsExactly<PaymentException>()\n            .WithMessage("Insufficient funds");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"partial-mocks-and-spy-pattern",children:"Partial Mocks and Spy Pattern"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using Moq;\n\npublic class NotificationServiceTests\n{\n    [Test]\n    public async Task SendNotification_LogsAttempt()\n    {\n        // Arrange - create a partial mock that calls real methods\n        var mockLogger = new Mock<ILogger>();\n        var notificationService = new Mock<NotificationService>(mockLogger.Object)\n        {\n            CallBase = true  // Call real implementation\n        };\n\n        // Override only the SendEmail method\n        notificationService\n            .Setup(n => n.SendEmailAsync(It.IsAny<string>(), It.IsAny<string>()))\n            .ReturnsAsync(true);\n\n        // Act\n        await notificationService.Object.NotifyUserAsync("user@example.com", "Hello");\n\n        // Assert - verify the real method called SendEmail\n        notificationService.Verify(\n            n => n.SendEmailAsync("user@example.com", It.IsAny<string>()),\n            Times.Once);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"data-driven-test-patterns",children:"Data-Driven Test Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"using-methoddatasource",children:"Using MethodDataSource"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"using TUnit.Core;\n\npublic class CalculatorDataDrivenTests\n{\n    [Test]\n    [MethodDataSource(nameof(GetCalculationTestCases))]\n    public async Task Add_ReturnsCorrectSum(int a, int b, int expected)\n    {\n        var calculator = new Calculator();\n        var result = calculator.Add(a, b);\n        await Assert.That(result).IsEqualTo(expected);\n    }\n\n    public static IEnumerable<(int, int, int)> GetCalculationTestCases()\n    {\n        yield return (1, 2, 3);\n        yield return (0, 0, 0);\n        yield return (-1, 1, 0);\n        yield return (100, 200, 300);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"using-methoddatasource-with-complex-objects",children:"Using MethodDataSource with Complex Objects"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class OrderValidationTests\n{\n    [Test]\n    [MethodDataSource(nameof(GetInvalidOrders))]\n    public async Task ValidateOrder_WithInvalidData_ReturnsErrors(\n        Order order,\n        string expectedError)\n    {\n        var validator = new OrderValidator();\n\n        var result = await validator.ValidateAsync(order);\n\n        await Assert.That(result.IsValid).IsFalse();\n        await Assert.That(result.Errors).Contains(e => e.Message.Contains(expectedError));\n    }\n\n    public static IEnumerable<(Order, string)> GetInvalidOrders()\n    {\n        yield return (\n            new Order { Total = 0, Items = new List<OrderItem>() },\n            "Order must have at least one item"\n        );\n\n        yield return (\n            new Order { Total = -10, Items = new List<OrderItem> { new() { Quantity = 1 } } },\n            "Total must be positive"\n        );\n\n        yield return (\n            new Order { Total = 100, CustomerId = 0, Items = new List<OrderItem> { new() } },\n            "Customer ID is required"\n        );\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"using-datasourcegenerator",children:"Using DataSourceGenerator"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using TUnit.Core;\n\npublic class UserTestDataGenerator : DataSourceGeneratorAttribute<User>\n{\n    public override IEnumerable<User> GenerateDataSources(DataGeneratorMetadata dataGeneratorMetadata)\n    {\n        yield return new User { Id = 1, Email = "user1@example.com", Role = "Admin" };\n        yield return new User { Id = 2, Email = "user2@example.com", Role = "User" };\n        yield return new User { Id = 3, Email = "user3@example.com", Role = "Guest" };\n    }\n}\n\npublic class UserPermissionTests\n{\n    [Test]\n    [UserTestDataGenerator]\n    public async Task CheckPermissions_ReturnsCorrectAccess(User user)\n    {\n        var permissionService = new PermissionService();\n\n        var canDelete = await permissionService.CanDeleteAsync(user);\n\n        if (user.Role == "Admin")\n            await Assert.That(canDelete).IsTrue();\n        else\n            await Assert.That(canDelete).IsFalse();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"exception-testing",children:"Exception Testing"}),"\n",(0,r.jsx)(n.h3,{id:"testing-for-specific-exceptions",children:"Testing for Specific Exceptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using TUnit.Core;\n\npublic class ExceptionTests\n{\n    [Test]\n    public async Task Divide_ByZero_ThrowsException()\n    {\n        var calculator = new Calculator();\n\n        await Assert.That(() => calculator.Divide(10, 0))\n            .ThrowsExactly<DivideByZeroException>();\n    }\n\n    [Test]\n    public async Task CreateUser_WithInvalidEmail_ThrowsValidationException()\n    {\n        var userService = new UserService();\n\n        await Assert.That(async () => await userService.CreateAsync("invalid-email", "John"))\n            .ThrowsExactly<ValidationException>()\n            .WithMessage("Invalid email format");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"testing-exception-messages-and-properties",children:"Testing Exception Messages and Properties"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class DetailedExceptionTests\n{\n    [Test]\n    public async Task ProcessPayment_InsufficientFunds_ThrowsWithDetails()\n    {\n        var paymentService = new PaymentService();\n        var payment = new Payment { Amount = 1000, AccountBalance = 100 };\n\n        var exception = await Assert.That(async () => await paymentService.ProcessAsync(payment))\n            .ThrowsExactly<PaymentException>();\n\n        await Assert.That(exception.Message).Contains("Insufficient funds");\n        await Assert.That(exception.RequiredAmount).IsEqualTo(1000);\n        await Assert.That(exception.AvailableAmount).IsEqualTo(100);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"testing-async-exceptions",children:"Testing Async Exceptions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class AsyncExceptionTests\n{\n    [Test]\n    public async Task FetchData_WithInvalidUrl_ThrowsHttpException()\n    {\n        var apiClient = new ApiClient();\n\n        // Test async method that throws\n        await Assert.That(async () => await apiClient.GetDataAsync("invalid-url"))\n            .ThrowsExactly<HttpRequestException>();\n    }\n\n    [Test]\n    public async Task ProcessBatch_WithTimeout_ThrowsTaskCanceledException()\n    {\n        var processor = new BatchProcessor();\n        using var cts = new CancellationTokenSource(TimeSpan.FromMilliseconds(100));\n\n        await Assert.That(async () => await processor.ProcessAsync(1000, cts.Token))\n            .Throws<TaskCanceledException>();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"integration-test-patterns",children:"Integration Test Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"testing-with-in-memory-database",children:"Testing with In-Memory Database"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.EntityFrameworkCore;\nusing TUnit.Core;\n\npublic class OrderRepositoryIntegrationTests\n{\n    private DbContextOptions<OrderDbContext>? _options;\n    private OrderDbContext? _context;\n\n    [Before(Test)]\n    public async Task Setup()\n    {\n        _options = new DbContextOptionsBuilder<OrderDbContext>()\n            .UseInMemoryDatabase(databaseName: Guid.NewGuid().ToString())\n            .Options;\n\n        _context = new OrderDbContext(_options);\n        await _context.Database.EnsureCreatedAsync();\n    }\n\n    [After(Test)]\n    public async Task Cleanup()\n    {\n        if (_context != null)\n        {\n            await _context.Database.EnsureDeletedAsync();\n            await _context.DisposeAsync();\n        }\n    }\n\n    [Test]\n    public async Task SaveOrder_PersistsToDatabase()\n    {\n        var repository = new OrderRepository(_context!);\n        var order = new Order\n        {\n            CustomerId = 1,\n            Total = 100.00m,\n            Status = OrderStatus.Pending\n        };\n\n        await repository.SaveAsync(order);\n        await _context!.SaveChangesAsync();\n\n        var saved = await _context.Orders.FirstOrDefaultAsync(o => o.Id == order.Id);\n        await Assert.That(saved).IsNotNull();\n        await Assert.That(saved!.Total).IsEqualTo(100.00m);\n    }\n\n    [Test]\n    public async Task GetOrder_WithRelatedData_LoadsNavigationProperties()\n    {\n        // Seed data\n        var order = new Order\n        {\n            CustomerId = 1,\n            Items = new List<OrderItem>\n            {\n                new() { ProductId = 1, Quantity = 2, Price = 10.00m },\n                new() { ProductId = 2, Quantity = 1, Price = 20.00m }\n            }\n        };\n        _context!.Orders.Add(order);\n        await _context.SaveChangesAsync();\n\n        // Test\n        var repository = new OrderRepository(_context);\n        var loaded = await repository.GetWithItemsAsync(order.Id);\n\n        await Assert.That(loaded).IsNotNull();\n        await Assert.That(loaded!.Items).HasCount().EqualTo(2);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"testing-with-test-containers-docker",children:"Testing with Test Containers (Docker)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using Testcontainers.PostgreSql;\nusing TUnit.Core;\n\npublic class PostgresIntegrationTests\n{\n    private PostgreSqlContainer? _container;\n    private string? _connectionString;\n\n    [Before(Test)]\n    public async Task Setup()\n    {\n        _container = new PostgreSqlBuilder()\n            .WithImage("postgres:15")\n            .WithDatabase("testdb")\n            .WithUsername("test")\n            .WithPassword("test")\n            .Build();\n\n        await _container.StartAsync();\n        _connectionString = _container.GetConnectionString();\n    }\n\n    [After(Test)]\n    public async Task Cleanup()\n    {\n        if (_container != null)\n            await _container.DisposeAsync();\n    }\n\n    [Test]\n    public async Task CanConnectToPostgres()\n    {\n        using var connection = new NpgsqlConnection(_connectionString);\n        await connection.OpenAsync();\n\n        await Assert.That(connection.State).IsEqualTo(ConnectionState.Open);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"testing-http-client-integration",children:"Testing HTTP Client Integration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using System.Net;\nusing TUnit.Core;\n\npublic class HttpClientIntegrationTests\n{\n    private HttpClient? _httpClient;\n\n    [Before(Test)]\n    public async Task Setup()\n    {\n        var handler = new HttpClientHandler\n        {\n            ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true\n        };\n\n        _httpClient = new HttpClient(handler)\n        {\n            BaseAddress = new Uri("https://api.example.com"),\n            Timeout = TimeSpan.FromSeconds(30)\n        };\n\n        _httpClient.DefaultRequestHeaders.Add("Authorization", "Bearer test-token");\n    }\n\n    [After(Test)]\n    public void Cleanup()\n    {\n        _httpClient?.Dispose();\n    }\n\n    [Test]\n    public async Task GetUser_ReturnsValidResponse()\n    {\n        var response = await _httpClient!.GetAsync("/users/1");\n\n        await Assert.That(response.StatusCode).IsEqualTo(HttpStatusCode.OK);\n\n        var user = await response.Content.ReadFromJsonAsync<User>();\n        await Assert.That(user).IsNotNull();\n        await Assert.That(user!.Id).IsEqualTo(1);\n    }\n\n    [Test]\n    public async Task GetUser_HandlesRateLimiting()\n    {\n        // Make multiple requests to trigger rate limiting\n        var tasks = Enumerable.Range(1, 100)\n            .Select(i => _httpClient!.GetAsync($"/users/{i}"));\n\n        var responses = await Task.WhenAll(tasks);\n\n        var rateLimited = responses.Count(r => r.StatusCode == HttpStatusCode.TooManyRequests);\n        await Assert.That(rateLimited).IsGreaterThan(0);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"testing-file-system-operations",children:"Testing File System Operations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using TUnit.Core;\n\npublic class FileServiceTests\n{\n    private string? _testDirectory;\n\n    [Before(Test)]\n    public async Task Setup()\n    {\n        _testDirectory = Path.Combine(Path.GetTempPath(), Guid.NewGuid().ToString());\n        Directory.CreateDirectory(_testDirectory);\n    }\n\n    [After(Test)]\n    public async Task Cleanup()\n    {\n        if (_testDirectory != null && Directory.Exists(_testDirectory))\n        {\n            Directory.Delete(_testDirectory, recursive: true);\n        }\n    }\n\n    [Test]\n    public async Task SaveFile_CreatesFileWithContent()\n    {\n        var fileService = new FileService();\n        var fileName = "test.txt";\n        var content = "Hello, World!";\n        var filePath = Path.Combine(_testDirectory!, fileName);\n\n        await fileService.SaveAsync(filePath, content);\n\n        await Assert.That(File.Exists(filePath)).IsTrue();\n        var savedContent = await File.ReadAllTextAsync(filePath);\n        await Assert.That(savedContent).IsEqualTo(content);\n    }\n\n    [Test, NotInParallel("FileSystem")]\n    public async Task DeleteFile_RemovesFile()\n    {\n        var filePath = Path.Combine(_testDirectory!, "delete-me.txt");\n        await File.WriteAllTextAsync(filePath, "content");\n\n        var fileService = new FileService();\n        await fileService.DeleteAsync(filePath);\n\n        await Assert.That(File.Exists(filePath)).IsFalse();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"These cookbook recipes cover the most common testing scenarios. You can adapt these patterns for your specific needs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Dependency Injection"}),": Use service collections for realistic testing with dependencies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Testing"}),": Use ",(0,r.jsx)(n.code,{children:"WebApplicationFactory"})," for end-to-end API tests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mocking"}),": Choose Moq or NSubstitute based on your preference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data-Driven Tests"}),": Use ",(0,r.jsx)(n.code,{children:"MethodDataSource"})," or ",(0,r.jsx)(n.code,{children:"DataSourceGenerator"})," for parameterized tests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Exception Testing"}),": Use TUnit's fluent exception assertions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integration Tests"}),": Test with real databases, containers, or file systems"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For more examples, check out the ",(0,r.jsx)(n.a,{href:"../examples/intro",children:"examples section"})," in the documentation."]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(6540);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);