"use strict";(globalThis.webpackChunktunit_docs_site=globalThis.webpackChunktunit_docs_site||[]).push([[424],{83340(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"test-authoring/mocking/setup","title":"Setup & Stubbing","description":"The mock.Setup surface configures how the mock responds when its members are called.","source":"@site/docs/test-authoring/mocking/setup.md","sourceDirName":"test-authoring/mocking","slug":"/test-authoring/mocking/setup","permalink":"/docs/test-authoring/mocking/setup","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"TUnit.Mocks","permalink":"/docs/test-authoring/mocking/"},"next":{"title":"Verification","permalink":"/docs/test-authoring/mocking/verification"}}');var s=t(74848),a=t(28453);const c={sidebar_position:2},i="Setup & Stubbing",o={},l=[{value:"Method Setup",id:"method-setup",level:2},{value:"Return Values",id:"return-values",level:3},{value:"Throwing Exceptions",id:"throwing-exceptions",level:3},{value:"Callbacks",id:"callbacks",level:3},{value:"Sequential Behaviors",id:"sequential-behaviors",level:3},{value:"Void Methods",id:"void-methods",level:3},{value:"Property Setup",id:"property-setup",level:2},{value:"Getter Setup",id:"getter-setup",level:3},{value:"Setter Setup",id:"setter-setup",level:3},{value:"Auto-Tracking Properties",id:"auto-tracking-properties",level:3},{value:"Out and Ref Parameters",id:"out-and-ref-parameters",level:2},{value:"Partial Mocks",id:"partial-mocks",level:2},{value:"Delegate Mocking",id:"delegate-mocking",level:2},{value:"Wrapping Real Objects",id:"wrapping-real-objects",level:2},{value:"Multi-Interface Mocks",id:"multi-interface-mocks",level:2},{value:"Setup Chaining",id:"setup-chaining",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"setup--stubbing",children:"Setup & Stubbing"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"mock.Setup"})," surface configures how the mock responds when its members are called."]}),"\n",(0,s.jsx)(n.h2,{id:"method-setup",children:"Method Setup"}),"\n",(0,s.jsx)(n.h3,{id:"return-values",children:"Return Values"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// Fixed return value\nmock.Setup.GetUser(Arg.Any<int>()).Returns(new User("Alice"));\n\n// Computed return value\nmock.Setup.GetUser(Arg.Any<int>()).Returns(() => new User(DateTime.Now.ToString()));\n\n// Async methods \u2014 no special API needed\nmock.Setup.GetUserAsync(Arg.Any<int>()).Returns(new User("Alice"));\n// TUnit.Mocks auto-wraps the value in Task<T> or ValueTask<T>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"throwing-exceptions",children:"Throwing Exceptions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// Throw a specific exception type\nmock.Setup.Delete(Arg.Any<int>()).Throws<InvalidOperationException>();\n\n// Throw a specific instance\nmock.Setup.Delete(Arg.Any<int>()).Throws(new ArgumentException("bad id"));\n'})}),"\n",(0,s.jsx)(n.h3,{id:"callbacks",children:"Callbacks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// Simple callback\nvar callCount = 0;\nmock.Setup.Process(Arg.Any<string>())\n    .Callback(() => callCount++);\n\n// Callback with access to arguments\nmock.Setup.Process(Arg.Any<string>())\n    .Callback((object?[] args) => Console.WriteLine($"Called with: {args[0]}"));\n'})}),"\n",(0,s.jsx)(n.h3,{id:"sequential-behaviors",children:"Sequential Behaviors"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:".Then()"})," to define different behaviors for successive calls:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'mock.Setup.GetValue(Arg.Any<string>())\n    .Throws<InvalidOperationException>()   // 1st call: throws\n    .Then()\n    .Returns("retry-succeeded")             // 2nd call: returns value\n    .Then()\n    .Returns("cached");                     // 3rd+ calls: returns this value\n\n// Shorthand for sequential return values\nmock.Setup.GetValue(Arg.Any<string>())\n    .ReturnsSequentially("first", "second", "third");\n// 1st: "first", 2nd: "second", 3rd+: "third" (last value repeats)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"void-methods",children:"Void Methods"}),"\n",(0,s.jsxs)(n.p,{children:["Void methods support ",(0,s.jsx)(n.code,{children:"Callback"})," and ",(0,s.jsx)(n.code,{children:"Throws"})," (but not ",(0,s.jsx)(n.code,{children:"Returns"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"mock.Setup.Log(Arg.Any<string>())\n    .Callback(() => { /* side effect */ });\n\nmock.Setup.Log(Arg.Any<string>())\n    .Throws<NotSupportedException>();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"property-setup",children:"Property Setup"}),"\n",(0,s.jsxs)(n.p,{children:["TUnit.Mocks uses C# 14 extension properties for a natural property API. The default behavior targets the ",(0,s.jsx)(n.strong,{children:"getter"})," (the most common case)."]}),"\n",(0,s.jsx)(n.h3,{id:"getter-setup",children:"Getter Setup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// These are equivalent \u2014 both configure the getter\nmock.Setup.Name.Returns("Alice");\nmock.Setup.Name.Getter.Returns("Alice");\n'})}),"\n",(0,s.jsx)(n.p,{children:"All method setup operations work on getters:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'mock.Setup.Name.Throws<InvalidOperationException>();\nmock.Setup.Name.Callback(() => Console.WriteLine("Name accessed"));\nmock.Setup.Name.ReturnsSequentially("first", "second");\n'})}),"\n",(0,s.jsx)(n.h3,{id:"setter-setup",children:"Setter Setup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// React to any value being set\nmock.Setup.Count.Setter.Callback(() => Console.WriteLine("Count was set"));\n\n// React to a specific value being set\nmock.Setup.Count.Set(Arg.Is(42)).Callback(() => Console.WriteLine("Count set to 42"));\n\n// Throw on setter\nmock.Setup.Name.Setter.Throws<NotSupportedException>();\n'})}),"\n",(0,s.jsx)(n.h3,{id:"auto-tracking-properties",children:"Auto-Tracking Properties"}),"\n",(0,s.jsxs)(n.p,{children:["Call ",(0,s.jsx)(n.code,{children:"SetupAllProperties()"})," to make properties behave like real auto-properties \u2014 setters store values, getters return them:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'var mock = Mock.Of<IEntity>();\nmock.SetupAllProperties();\n\nmock.Object.Name = "Alice";\nvar name = mock.Object.Name; // "Alice"\n\nmock.Object.Count = 10;\nvar count = mock.Object.Count; // 10\n'})}),"\n",(0,s.jsx)(n.p,{children:"Explicit setups take precedence over auto-tracked values."}),"\n",(0,s.jsx)(n.h2,{id:"out-and-ref-parameters",children:"Out and Ref Parameters"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Out parameters"})," are excluded from setup signatures. Use ",(0,s.jsx)(n.code,{children:".SetsOutParameter()"})," to assign their values:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'mock.Setup.TryGet("key")\n    .Returns(true)\n    .SetsOutParameter(0, "found-value"); // paramIndex 0 = first out param\n\nbool found = svc.TryGet("key", out var value);\n// found == true, value == "found-value"\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ref parameters"})," are included in setup signatures and participate in argument matching."]}),"\n",(0,s.jsx)(n.h2,{id:"partial-mocks",children:"Partial Mocks"}),"\n",(0,s.jsx)(n.p,{children:"Partial mocks wrap a real class. Unconfigured method calls execute the base implementation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public abstract class Calculator\n{\n    public virtual int Add(int a, int b) => a + b;\n    public abstract int Multiply(int a, int b);\n}\n\nvar mock = Mock.OfPartial<Calculator>();\nmock.Setup.Multiply(Arg.Any<int>(), Arg.Any<int>()).Returns(99);\n\nmock.Object.Add(2, 3);      // 5 (base implementation)\nmock.Object.Multiply(2, 3); // 99 (mocked)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Pass constructor arguments for non-default constructors:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'var mock = Mock.OfPartial<MyService>("connectionString", 42);\n'})}),"\n",(0,s.jsx)(n.h2,{id:"delegate-mocking",children:"Delegate Mocking"}),"\n",(0,s.jsx)(n.p,{children:"Mock any delegate type:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'var mock = Mock.OfDelegate<Func<string, int>>();\nmock.Setup.Invoke(Arg.Any<string>()).Returns(42);\n\nFunc<string, int> func = mock;\nvar result = func("hello"); // 42\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Works with ",(0,s.jsx)(n.code,{children:"Action<>"}),", ",(0,s.jsx)(n.code,{children:"Func<>"}),", and custom delegate types."]}),"\n",(0,s.jsx)(n.h2,{id:"wrapping-real-objects",children:"Wrapping Real Objects"}),"\n",(0,s.jsx)(n.p,{children:"Wrap a real instance to selectively override methods while delegating unconfigured calls to the real implementation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"var realService = new ProductionService();\nvar mock = Mock.Wrap(realService);\n\n// Override just one method\nmock.Setup.GetConfig().Returns(new TestConfig());\n\n// All other calls go to realService\nmock.Object.DoWork(); // calls realService.DoWork()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"multi-interface-mocks",children:"Multi-Interface Mocks"}),"\n",(0,s.jsx)(n.p,{children:"Create a single mock that implements multiple interfaces:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'var mock = Mock.Of<ILogger, IDisposable>();\n\nmock.Setup.Log(Arg.Any<string>()); // ILogger method\nmock.Object.Log("test");\n\n((IDisposable)mock.Object).Dispose(); // IDisposable method\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Supports up to 4 interfaces: ",(0,s.jsx)(n.code,{children:"Mock.Of<T1, T2, T3, T4>()"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"setup-chaining",children:"Setup Chaining"}),"\n",(0,s.jsx)(n.p,{children:"Setup methods return chain objects that support additional behaviors:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'mock.Setup.Process(Arg.Any<int>())\n    .Returns(true)\n    .RaisesProcessCompleted(EventArgs.Empty)   // strongly-typed auto-raise event\n    .TransitionsTo("processed");               // state machine transition\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The typed ",(0,s.jsx)(n.code,{children:".Raises{EventName}()"})," methods provide IntelliSense and compile-time safety for event parameters. The string-based ",(0,s.jsx)(n.code,{children:".Raises(eventName, args)"})," overload is also available."]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"advanced",children:"Advanced Features"})," for details on events and state machines."]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>c,x:()=>i});var r=t(96540);const s={},a=r.createContext(s);function c(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);