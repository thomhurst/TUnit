"use strict";(self.webpackChunktunit_docs_site=self.webpackChunktunit_docs_site||[]).push([[6505],{63615:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"customization-extensibility/logging","title":"Logging","description":"TUnit provides a flexible logging system that captures all test output and routes it to configurable destinations called \\"log sinks\\".","source":"@site/docs/customization-extensibility/logging.md","sourceDirName":"customization-extensibility","slug":"/customization-extensibility/logging","permalink":"/docs/customization-extensibility/logging","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Display Names","permalink":"/docs/customization-extensibility/display-names"},"next":{"title":"Libraries","permalink":"/docs/customization-extensibility/libraries"}}');var i=t(74848),o=t(28453);const r={},l="Logging",a={},c=[{value:"Basic Usage",id:"basic-usage",level:2},{value:"Logger Objects",id:"logger-objects",level:3},{value:"Log Sinks",id:"log-sinks",level:2},{value:"Built-in Sinks",id:"built-in-sinks",level:3},{value:"Creating Custom Log Sinks",id:"creating-custom-log-sinks",level:3},{value:"Registering Custom Sinks",id:"registering-custom-sinks",level:3},{value:"Context Information",id:"context-information",level:3},{value:"Example: Seq/Serilog Integration",id:"example-seqserilog-integration",level:3},{value:"Log Levels",id:"log-levels",level:2},{value:"Custom Loggers",id:"custom-loggers",level:2},{value:"Available Extension Points",id:"available-extension-points",level:3}];function g(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"logging",children:"Logging"})}),"\n",(0,i.jsx)(n.p,{children:'TUnit provides a flexible logging system that captures all test output and routes it to configurable destinations called "log sinks".'}),"\n",(0,i.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsxs)(n.p,{children:["By default, TUnit intercepts any logs to ",(0,i.jsx)(n.code,{children:"Console.WriteLine()"})," and correlates them to the test that triggered the log using the current async context."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'[Test]\npublic async Task MyTest()\n{\n    Console.WriteLine("This output is captured and associated with this test");\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"logger-objects",children:"Logger Objects"}),"\n",(0,i.jsxs)(n.p,{children:["For more control, use ",(0,i.jsx)(n.code,{children:"TestContext.Current.GetDefaultLogger()"})," to get a logger instance:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'[Test]\npublic async Task MyTest()\n{\n    var logger = TestContext.Current!.GetDefaultLogger();\n    logger.LogInformation("Information message");\n    logger.LogWarning("Warning message");\n    logger.LogError("Error message");\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"This logger can integrate with other logging frameworks like Microsoft.Extensions.Logging for ASP.NET applications."}),"\n",(0,i.jsx)(n.h2,{id:"log-sinks",children:"Log Sinks"}),"\n",(0,i.jsx)(n.p,{children:"TUnit uses a sink-based architecture where all output is routed through registered log sinks. Each sink decides how to handle the messages - write to files, stream to IDEs, send to external services, etc."}),"\n",(0,i.jsx)(n.h3,{id:"built-in-sinks",children:"Built-in Sinks"}),"\n",(0,i.jsx)(n.p,{children:"TUnit automatically registers these sinks based on your execution context:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Sink"}),(0,i.jsx)(n.th,{children:"When Registered"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"TestOutputSink"})}),(0,i.jsx)(n.td,{children:"Always"}),(0,i.jsx)(n.td,{children:"Captures output for test results shown after execution"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ConsoleOutputSink"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--output Detailed"})}),(0,i.jsx)(n.td,{children:"Writes real-time output to the console"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"RealTimeOutputSink"})}),(0,i.jsx)(n.td,{children:"IDE clients (VS, Rider)"}),(0,i.jsx)(n.td,{children:"Streams output to IDE test explorers"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"creating-custom-log-sinks",children:"Creating Custom Log Sinks"}),"\n",(0,i.jsxs)(n.p,{children:["Implement the ",(0,i.jsx)(n.code,{children:"ILogSink"})," interface to create a custom sink:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using TUnit.Core;\nusing TUnit.Core.Logging;\n\npublic class FileLogSink : ILogSink, IAsyncDisposable\n{\n    private readonly StreamWriter _writer;\n\n    public FileLogSink(string filePath)\n    {\n        _writer = new StreamWriter(filePath, append: true);\n    }\n\n    public bool IsEnabled(LogLevel level)\n    {\n        // Return false to skip processing for performance\n        return level >= LogLevel.Information;\n    }\n\n    public void Log(LogLevel level, string message, Exception? exception, Context? context)\n    {\n        // Get test name from context if available\n        var testName = context is TestContext tc\n            ? tc.TestDetails.TestName\n            : "Unknown";\n\n        _writer.WriteLine($"[{DateTime.Now:HH:mm:ss}] [{level}] [{testName}] {message}");\n\n        if (exception != null)\n        {\n            _writer.WriteLine(exception.ToString());\n        }\n    }\n\n    public ValueTask LogAsync(LogLevel level, string message, Exception? exception, Context? context)\n    {\n        Log(level, message, exception, context);\n        return ValueTask.CompletedTask;\n    }\n\n    public async ValueTask DisposeAsync()\n    {\n        await _writer.FlushAsync();\n        await _writer.DisposeAsync();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"registering-custom-sinks",children:"Registering Custom Sinks"}),"\n",(0,i.jsxs)(n.p,{children:["Register your sink in a ",(0,i.jsx)(n.code,{children:"[Before(Assembly)]"})," hook so it's active before any tests run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class TestSetup\n{\n    [Before(Assembly)]\n    public static void SetupLogging()\n    {\n        // Register by instance (for sinks needing configuration)\n        TUnitLoggerFactory.AddSink(new FileLogSink("test-output.log"));\n\n        // Or register by type (for simple sinks)\n        TUnitLoggerFactory.AddSink<DebugLogSink>();\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Sinks that implement ",(0,i.jsx)(n.code,{children:"IDisposable"})," or ",(0,i.jsx)(n.code,{children:"IAsyncDisposable"})," are automatically disposed when the test session ends."]}),"\n",(0,i.jsx)(n.h3,{id:"context-information",children:"Context Information"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"context"})," parameter provides information about where the log originated:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"public void Log(LogLevel level, string message, Exception? exception, Context? context)\n{\n    switch (context)\n    {\n        case TestContext tc:\n            // During test execution\n            var testName = tc.TestDetails.TestName;\n            var className = tc.TestDetails.ClassType.Name;\n            break;\n\n        case ClassHookContext chc:\n            // During [Before(Class)] or [After(Class)] hooks\n            var classType = chc.ClassType;\n            break;\n\n        case AssemblyHookContext ahc:\n            // During [Before(Assembly)] or [After(Assembly)] hooks\n            var assembly = ahc.Assembly;\n            break;\n\n        case null:\n            // Outside test execution\n            break;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-seqserilog-integration",children:"Example: Seq/Serilog Integration"}),"\n",(0,i.jsx)(n.p,{children:"Here's an example sink that sends logs to Seq:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class SeqLogSink : ILogSink, IDisposable\n{\n    private readonly Serilog.ILogger _logger;\n\n    public SeqLogSink(string seqUrl)\n    {\n        _logger = new LoggerConfiguration()\n            .WriteTo.Seq(seqUrl)\n            .CreateLogger();\n    }\n\n    public bool IsEnabled(LogLevel level) => true;\n\n    public void Log(LogLevel level, string message, Exception? exception, Context? context)\n    {\n        var serilogLevel = level switch\n        {\n            LogLevel.Trace => Serilog.Events.LogEventLevel.Verbose,\n            LogLevel.Debug => Serilog.Events.LogEventLevel.Debug,\n            LogLevel.Information => Serilog.Events.LogEventLevel.Information,\n            LogLevel.Warning => Serilog.Events.LogEventLevel.Warning,\n            LogLevel.Error => Serilog.Events.LogEventLevel.Error,\n            LogLevel.Critical => Serilog.Events.LogEventLevel.Fatal,\n            _ => Serilog.Events.LogEventLevel.Information\n        };\n\n        var testName = context is TestContext tc ? tc.TestDetails.TestName : "Unknown";\n\n        _logger\n            .ForContext("TestName", testName)\n            .Write(serilogLevel, exception, message);\n    }\n\n    public ValueTask LogAsync(LogLevel level, string message, Exception? exception, Context? context)\n    {\n        Log(level, message, exception, context);\n        return ValueTask.CompletedTask;\n    }\n\n    public void Dispose()\n    {\n        (_logger as IDisposable)?.Dispose();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"log-levels",children:"Log Levels"}),"\n",(0,i.jsx)(n.p,{children:"TUnit uses the same log level as provided to the Microsoft.Testing.Platform via command line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"dotnet run --log-level Warning\n"})}),"\n",(0,i.jsx)(n.p,{children:"Available levels (from least to most severe):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Trace"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Debug"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Information"})," (default)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Warning"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Error"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Critical"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"custom-loggers",children:"Custom Loggers"}),"\n",(0,i.jsxs)(n.p,{children:["You can also create custom loggers by inheriting from ",(0,i.jsx)(n.code,{children:"DefaultLogger"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class TestHeaderLogger : DefaultLogger\n{\n    private bool _hasOutputHeader;\n\n    public TestHeaderLogger(Context context) : base(context) { }\n\n    protected override string GenerateMessage(string message, Exception? exception, LogLevel logLevel)\n    {\n        var baseMessage = base.GenerateMessage(message, exception, logLevel);\n\n        if (!_hasOutputHeader && Context is TestContext testContext)\n        {\n            _hasOutputHeader = true;\n            var testId = $"{testContext.TestDetails.ClassType.Name}.{testContext.TestDetails.TestName}";\n            return $"--- {testId} ---\\n{baseMessage}";\n        }\n\n        return baseMessage;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"available-extension-points",children:"Available Extension Points"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Context"})," - Protected property to access the associated context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GenerateMessage(message, exception, logLevel)"})," - Override to customize message formatting"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WriteToOutput(message, isError)"})," - Override to customize synchronous output"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WriteToOutputAsync(message, isError)"})," - Override for asynchronous output"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var s=t(96540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);