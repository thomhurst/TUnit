"use strict";(globalThis.webpackChunktunit_docs_site=globalThis.webpackChunktunit_docs_site||[]).push([[428],{64959(e,t,s){s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"examples/opentelemetry","title":"OpenTelemetry Tracing","description":"TUnit emits System.Diagnostics.Activity trace spans at every level of the test lifecycle. When you configure an OpenTelemetry exporter (or any ActivityListener), you get distributed tracing for your test runs automatically. When no listener is attached, the cost is zero.","source":"@site/docs/examples/opentelemetry.md","sourceDirName":"examples","slug":"/examples/opentelemetry","permalink":"/docs/examples/opentelemetry","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Playwright","permalink":"/docs/examples/playwright"},"next":{"title":"FsCheck (Property-Based Testing)","permalink":"/docs/examples/fscheck"}}');var r=s(74848),i=s(28453);const c={},d="OpenTelemetry Tracing",l={},a=[{value:"Setup",id:"setup",level:2},{value:"Span Hierarchy",id:"span-hierarchy",level:2},{value:"Attributes",id:"attributes",level:2},{value:"Standard OTel Attributes",id:"standard-otel-attributes",level:3},{value:"TUnit-Specific Attributes",id:"tunit-specific-attributes",level:3},{value:"Span Status",id:"span-status",level:2},{value:"Retries",id:"retries",level:2},{value:"Using with Jaeger, Zipkin, or OTLP",id:"using-with-jaeger-zipkin-or-otlp",level:2}];function o(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"opentelemetry-tracing",children:"OpenTelemetry Tracing"})}),"\n",(0,r.jsxs)(t.p,{children:["TUnit emits ",(0,r.jsx)(t.code,{children:"System.Diagnostics.Activity"})," trace spans at every level of the test lifecycle. When you configure an OpenTelemetry exporter (or any ",(0,r.jsx)(t.code,{children:"ActivityListener"}),"), you get distributed tracing for your test runs automatically. When no listener is attached, the cost is zero."]}),"\n",(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsx)(t.p,{children:"Activity tracing requires .NET 8 or later. It is not available on .NET Framework or .NET Standard targets."})}),"\n",(0,r.jsx)(t.h2,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(t.p,{children:"Add the OpenTelemetry packages to your test project:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"dotnet add package OpenTelemetry\ndotnet add package OpenTelemetry.Exporter.Console\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Then subscribe to the ",(0,r.jsx)(t.code,{children:'"TUnit"'})," ActivitySource in your test setup:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:'using System.Diagnostics;\nusing OpenTelemetry;\nusing OpenTelemetry.Trace;\nusing OpenTelemetry.Resources;\n\npublic class TraceSetup\n{\n    private static TracerProvider? _tracerProvider;\n\n    [Before(TestSession)]\n    public static void SetupTracing()\n    {\n        _tracerProvider = Sdk.CreateTracerProviderBuilder()\n            .SetResourceBuilder(ResourceBuilder.CreateDefault().AddService("MyTests"))\n            .AddSource("TUnit")\n            .AddConsoleExporter()\n            .Build();\n    }\n\n    [After(TestSession)]\n    public static void TeardownTracing()\n    {\n        _tracerProvider?.Dispose();\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Replace ",(0,r.jsx)(t.code,{children:"AddConsoleExporter()"})," with your preferred exporter (Jaeger, Zipkin, OTLP, etc.)."]}),"\n",(0,r.jsx)(t.h2,{id:"span-hierarchy",children:"Span Hierarchy"}),"\n",(0,r.jsx)(t.p,{children:"TUnit creates a nested span tree that mirrors the test lifecycle:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"test session\n  \u2514\u2500\u2500 test assembly\n        \u2514\u2500\u2500 test suite (one per test class)\n              \u2514\u2500\u2500 test case (one per test method invocation)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"attributes",children:"Attributes"}),"\n",(0,r.jsxs)(t.p,{children:["Each span carries tags that follow ",(0,r.jsx)(t.a,{href:"https://opentelemetry.io/docs/specs/semconv/",children:"OpenTelemetry semantic conventions"})," where applicable."]}),"\n",(0,r.jsx)(t.h3,{id:"standard-otel-attributes",children:"Standard OTel Attributes"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Attribute"}),(0,r.jsx)(t.th,{children:"Span"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"test.case.name"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Test method name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"test.case.result.status"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.code,{children:"pass"}),", ",(0,r.jsx)(t.code,{children:"fail"}),", or ",(0,r.jsx)(t.code,{children:"skipped"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"test.suite.name"})}),(0,r.jsx)(t.td,{children:"test suite"}),(0,r.jsx)(t.td,{children:"Test class name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"error.type"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Exception type (on failure)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"exception.type"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Exception type (on exception event)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"exception.message"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Exception message (on exception event)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"exception.stacktrace"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Full stack trace (on exception event)"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"tunit-specific-attributes",children:"TUnit-Specific Attributes"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Attribute"}),(0,r.jsx)(t.th,{children:"Span"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.session.id"})}),(0,r.jsx)(t.td,{children:"test session"}),(0,r.jsx)(t.td,{children:"Unique session identifier"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.filter"})}),(0,r.jsx)(t.td,{children:"test session"}),(0,r.jsx)(t.td,{children:"Active test filter expression"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.assembly.name"})}),(0,r.jsx)(t.td,{children:"test assembly"}),(0,r.jsx)(t.td,{children:"Assembly name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.class.namespace"})}),(0,r.jsx)(t.td,{children:"test suite"}),(0,r.jsx)(t.td,{children:"Class namespace"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.test.class"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Fully qualified class name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.test.method"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Method name"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.test.id"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Unique test instance ID"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.test.categories"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Test categories (string array)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.test.count"})}),(0,r.jsx)(t.td,{children:"session/assembly/suite"}),(0,r.jsx)(t.td,{children:"Total test count"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.test.retry_attempt"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Current retry attempt (when retrying)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"tunit.test.skip_reason"})}),(0,r.jsx)(t.td,{children:"test case"}),(0,r.jsx)(t.td,{children:"Reason the test was skipped"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"span-status",children:"Span Status"}),"\n",(0,r.jsx)(t.p,{children:"Following OTel instrumentation conventions:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Passed tests"}),": status is left as ",(0,r.jsx)(t.code,{children:"Unset"})," (the default \u2014 success is implicit)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Failed tests"}),": status is set to ",(0,r.jsx)(t.code,{children:"Error"})," with an exception event recorded"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Skipped tests"}),": status is left as ",(0,r.jsx)(t.code,{children:"Unset"})," with ",(0,r.jsx)(t.code,{children:"test.case.result.status"})," = ",(0,r.jsx)(t.code,{children:"skipped"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"retries",children:"Retries"}),"\n",(0,r.jsxs)(t.p,{children:["When a test is configured with ",(0,r.jsx)(t.code,{children:"[Retry]"}),", each failed attempt produces its own span with ",(0,r.jsx)(t.code,{children:"Error"})," status and the recorded exception. The retry attempt that finally passes (or the last failing attempt) is the final span for that test."]}),"\n",(0,r.jsx)(t.h2,{id:"using-with-jaeger-zipkin-or-otlp",children:"Using with Jaeger, Zipkin, or OTLP"}),"\n",(0,r.jsx)(t.p,{children:"Swap the exporter in the setup:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:'// OTLP (works with Jaeger, Tempo, Honeycomb, etc.)\ndotnet add package OpenTelemetry.Exporter.OpenTelemetryProtocol\n\n.AddOtlpExporter(opts => opts.Endpoint = new Uri("http://localhost:4317"))\n\n// Zipkin\ndotnet add package OpenTelemetry.Exporter.Zipkin\n\n.AddZipkinExporter(opts => opts.Endpoint = new Uri("http://localhost:9411/api/v2/spans"))\n'})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453(e,t,s){s.d(t,{R:()=>c,x:()=>d});var n=s(96540);const r={},i=n.createContext(r);function c(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);