"use strict";(globalThis.webpackChunktunit_docs_site=globalThis.webpackChunktunit_docs_site||[]).push([[3102],{32502(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"test-authoring/mocking/advanced","title":"Advanced Features","description":"Events","source":"@site/docs/test-authoring/mocking/advanced.md","sourceDirName":"test-authoring/mocking","slug":"/test-authoring/mocking/advanced","permalink":"/docs/test-authoring/mocking/advanced","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docs","previous":{"title":"Argument Matchers","permalink":"/docs/test-authoring/mocking/argument-matchers"},"next":{"title":"HTTP Mocking","permalink":"/docs/test-authoring/mocking/http"}}');var c=t(74848),r=t(28453);const i={sidebar_position:5},o="Advanced Features",a={},d=[{value:"Events",id:"events",level:2},{value:"Raising Events",id:"raising-events",level:3},{value:"Auto-Raise on Method Call",id:"auto-raise-on-method-call",level:3},{value:"Event Subscription Tracking",id:"event-subscription-tracking",level:3},{value:"State Machine Mocking",id:"state-machine-mocking",level:2},{value:"State API",id:"state-api",level:3},{value:"Recursive / Auto-Mocking",id:"recursive--auto-mocking",level:2},{value:"MockRepository",id:"mockrepository",level:2},{value:"Repository API",id:"repository-api",level:3},{value:"Diagnostics",id:"diagnostics",level:2},{value:"Custom Default Value Provider",id:"custom-default-value-provider",level:2},{value:"Reset",id:"reset",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"advanced-features",children:"Advanced Features"})}),"\n",(0,c.jsx)(n.h2,{id:"events",children:"Events"}),"\n",(0,c.jsx)(n.h3,{id:"raising-events",children:"Raising Events"}),"\n",(0,c.jsxs)(n.p,{children:["If the mocked interface declares events, TUnit.Mocks generates a ",(0,c.jsx)(n.code,{children:"Raise"})," surface:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'public interface IConnection\n{\n    event EventHandler<string>? OnMessage;\n    event Action? OnDisconnect;\n}\n\nvar mock = Mock.Of<IConnection>();\n\n// Subscribe to the event\nstring? received = null;\nmock.Object.OnMessage += (sender, msg) => received = msg;\n\n// Raise the event through the mock\nmock.Raise.OnMessage("Hello!");\n// received == "Hello!"\n'})}),"\n",(0,c.jsx)(n.h3,{id:"auto-raise-on-method-call",children:"Auto-Raise on Method Call"}),"\n",(0,c.jsxs)(n.p,{children:["Trigger an event automatically when a method is called using the typed ",(0,c.jsx)(n.code,{children:".Raises{EventName}()"})," method on a setup chain:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'mock.Setup.SendMessage(Arg.Any<string>())\n    .RaisesOnMessage("echo");\n\nmock.Object.SendMessage("test");\n// OnMessage event fires with "echo"\n'})}),"\n",(0,c.jsxs)(n.p,{children:["The typed raise methods are generated per-event with correct parameter types, giving you IntelliSense and compile-time safety. The string-based ",(0,c.jsx)(n.code,{children:".Raises(eventName, args)"})," overload is still available for dynamic scenarios."]}),"\n",(0,c.jsx)(n.h3,{id:"event-subscription-tracking",children:"Event Subscription Tracking"}),"\n",(0,c.jsxs)(n.p,{children:["Query and react to event subscriptions through the strongly-typed ",(0,c.jsx)(n.code,{children:"Events"})," surface:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'var mock = Mock.Of<IConnection>();\n\n// Register callbacks for subscribe/unsubscribe\nmock.Events.OnMessage.OnSubscribe(() => Console.WriteLine("subscribed"));\nmock.Events.OnMessage.OnUnsubscribe(() => Console.WriteLine("unsubscribed"));\n\nmock.Object.OnMessage += (s, e) => { };\n// prints "subscribed"\n\n// Query subscriber info\nvar wasSubscribed = mock.Events.OnMessage.WasSubscribed;   // true\nvar count = mock.Events.OnMessage.SubscriberCount;          // 1\n'})}),"\n",(0,c.jsx)(n.h2,{id:"state-machine-mocking",children:"State Machine Mocking"}),"\n",(0,c.jsx)(n.p,{children:"Model stateful behavior where method responses depend on the mock's current state:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'public interface IConnection\n{\n    string GetStatus();\n    void Connect();\n    void Disconnect();\n}\n\nvar mock = Mock.Of<IConnection>();\nmock.SetState("disconnected");\n\nmock.InState("disconnected", setup =>\n{\n    setup.GetStatus().Returns("OFFLINE");\n    setup.Connect().TransitionsTo("connected");\n});\n\nmock.InState("connected", setup =>\n{\n    setup.GetStatus().Returns("ONLINE");\n    setup.Disconnect().TransitionsTo("disconnected");\n});\n\n// Start disconnected\nvar status = mock.Object.GetStatus(); // "OFFLINE"\n\nmock.Object.Connect(); // transitions to "connected"\nstatus = mock.Object.GetStatus();     // "ONLINE"\n\nmock.Object.Disconnect(); // transitions back to "disconnected"\nstatus = mock.Object.GetStatus();     // "OFFLINE"\n'})}),"\n",(0,c.jsx)(n.h3,{id:"state-api",children:"State API"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Method"}),(0,c.jsx)(n.th,{children:"Description"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:'mock.SetState("name")'})}),(0,c.jsx)(n.td,{children:"Set the current state"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"mock.SetState(null)"})}),(0,c.jsx)(n.td,{children:"Clear state (all setups match)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:'mock.InState("name", configure)'})}),(0,c.jsx)(n.td,{children:"Register setups scoped to a state"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:'.TransitionsTo("name")'})}),(0,c.jsx)(n.td,{children:"Transition state after method call (on setup chain)"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"recursive--auto-mocking",children:"Recursive / Auto-Mocking"}),"\n",(0,c.jsx)(n.p,{children:"In loose mode, methods returning interface types automatically return functional mocks instead of null:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'public interface IServiceA\n{\n    IServiceB GetServiceB();\n}\n\npublic interface IServiceB\n{\n    int GetValue();\n}\n\nvar mock = Mock.Of<IServiceA>();\n\n// GetServiceB() automatically returns an auto-mock\nvar serviceB = mock.Object.GetServiceB();\n// serviceB is not null \u2014 it\'s a working mock\n\n// Configure the auto-mock\nvar autoMock = mock.GetAutoMock<IServiceB>("GetServiceB");\nautoMock.Setup.GetValue().Returns(42);\n\nvar value = serviceB.GetValue(); // 42\n'})}),"\n",(0,c.jsx)(n.p,{children:"Auto-mocks are cached \u2014 calling the same method returns the same mock instance."}),"\n",(0,c.jsx)(n.h2,{id:"mockrepository",children:"MockRepository"}),"\n",(0,c.jsx)(n.p,{children:"Manage multiple mocks with shared behavior and batch operations:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'var repo = new MockRepository(MockBehavior.Strict);\n\nvar serviceMock = repo.Of<IService>();\nvar loggerMock = repo.Of<ILogger>();\n\n// Configure each mock individually\nserviceMock.Setup.GetData(Arg.Any<int>()).Returns("result");\nloggerMock.Setup.Log(Arg.Any<string>());\n\n// Exercise code\nserviceMock.Object.GetData(1);\nloggerMock.Object.Log("hello");\n\n// Batch verification\nrepo.VerifyAll();            // all setups invoked across all mocks\nrepo.VerifyNoOtherCalls();   // no unverified calls on any mock\n\n// Batch reset\nrepo.Reset();                // clear all mocks\n'})}),"\n",(0,c.jsx)(n.h3,{id:"repository-api",children:"Repository API"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Method"}),(0,c.jsx)(n.th,{children:"Description"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.Of<T>()"})}),(0,c.jsx)(n.td,{children:"Create and track a loose mock"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.Of<T>(behavior)"})}),(0,c.jsx)(n.td,{children:"Create and track a mock with specific behavior"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.OfPartial<T>(args)"})}),(0,c.jsx)(n.td,{children:"Create and track a partial mock"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.Track(existingMock)"})}),(0,c.jsx)(n.td,{children:"Add an existing mock to the repository"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.Mocks"})}),(0,c.jsx)(n.td,{children:"All tracked mocks"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.VerifyAll()"})}),(0,c.jsx)(n.td,{children:"Verify all setups on all mocks"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.VerifyNoOtherCalls()"})}),(0,c.jsx)(n.td,{children:"Verify no unverified calls on any mock"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"repo.Reset()"})}),(0,c.jsx)(n.td,{children:"Reset all mocks"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"diagnostics",children:"Diagnostics"}),"\n",(0,c.jsx)(n.p,{children:"Get a diagnostic report of setup coverage and call matching:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'mock.Setup.GetUser(Arg.Any<int>()).Returns(new User("Alice"));\nmock.Setup.Delete(Arg.Any<int>());\n\nsvc.GetUser(1);\n// Delete was never called\n\nvar diag = mock.GetDiagnostics();\ndiag.TotalSetups;       // 2\ndiag.ExercisedSetups;   // 1\ndiag.UnusedSetups;      // [Delete(Arg.Any<int>())]\ndiag.UnmatchedCalls;    // [] (all calls matched a setup)\n'})}),"\n",(0,c.jsx)(n.p,{children:"Useful for debugging why a mock isn't behaving as expected, or for finding dead setups."}),"\n",(0,c.jsx)(n.h2,{id:"custom-default-value-provider",children:"Custom Default Value Provider"}),"\n",(0,c.jsx)(n.p,{children:"Override the default return values for unconfigured methods in loose mode:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'public class TestDefaults : IDefaultValueProvider\n{\n    public bool CanProvide(Type type)\n        => type == typeof(string) || type == typeof(int);\n\n    public object? GetDefaultValue(Type type) => type switch\n    {\n        _ when type == typeof(string) => "test-default",\n        _ when type == typeof(int) => -1,\n        _ => null\n    };\n}\n\nvar mock = Mock.Of<IService>();\nmock.DefaultValueProvider = new TestDefaults();\n\nvar name = mock.Object.GetName();  // "test-default" (no setup needed)\nvar count = mock.Object.GetCount(); // -1\n'})}),"\n",(0,c.jsxs)(n.p,{children:["The provider is consulted ",(0,c.jsx)(n.strong,{children:"before"})," auto-mocking and built-in smart defaults."]}),"\n",(0,c.jsx)(n.h2,{id:"reset",children:"Reset"}),"\n",(0,c.jsx)(n.p,{children:"Clear all setups, call history, state, and auto-tracked property values:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'mock.Setup.GetUser(Arg.Any<int>()).Returns(new User("Alice"));\nsvc.GetUser(1);\n\nmock.Reset();\n\nsvc.GetUser(1); // returns default (setup cleared)\nmock.Invocations.Count; // 0 (history cleared)\n'})}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"SetupAllProperties()"})," flag is preserved across resets."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},28453(e,n,t){t.d(n,{R:()=>i,x:()=>o});var s=t(96540);const c={},r=s.createContext(c);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);